# Day 1-2 核心基礎搭建 - 開發階段規劃與 Checklist

---

## 📋 總目標與核心產出

### 總目標
建立可運行的單輪對話框架，實現 Agent 與使用者的基本互動能力

### 核心產出清單
- [ ] 完整的開發環境（LangChain + LangGraph + OpenAI API）
- [ ] State Schema 定義檔案
- [ ] LLM 推論節點實作
- [ ] 基礎 Graph 架構（START → LLM Node → END）
- [ ] InMemoryStore 短期記憶機制
- [ ] 命令列互動介面（CLI）
- [ ] 完整測試套件
- [ ] 可執行的對話原型

## 📂 階段一：環境準備與基礎架構（4小時）

### 工作任務 1.1：開發環境設定（30分鐘）

**任務目標**：建立乾淨的 Python 虛擬環境並安裝核心套件

**執行步驟**：
- [Ｘ] 建立專案目錄 `travel_agent_mvp`
- [ ] 建立並啟動 Python 虛擬環境
- [ ] 安裝核心套件：
  - langchain（最新版本）
  - langgraph（最新版本）
  - langchain-openai（OpenAI 整合）
  - python-dotenv（環境變數管理）
- [ ] 產生 `requirements.txt` 依賴清單
- [ ] 驗證安裝：測試 import 所有套件

**驗證標準**：
- ✅ 所有套件成功安裝無錯誤
- ✅ 可成功 import langchain, langgraph, langchain_openai
- ✅ requirements.txt 已產生

---

### 工作任務 1.2：專案結構規劃（15分鐘）

**任務目標**：建立標準化的專案檔案結構

**檔案結構規劃**：
```
travel_agent_mvp/
├── venv/                   # 虛擬環境
├── .env                    # 環境變數配置
├── .gitignore             # Git 忽略檔案
├── requirements.txt        # 依賴清單
├── state.py               # State Schema 定義
├── nodes.py               # Graph Nodes 實作
├── graph.py               # Graph 建構與編譯
├── main.py                # CLI 執行入口
└── test_agent.py          # 單元測試
```

**執行步驟**：
- [ ] 建立所有必要的 Python 檔案
- [ ] 建立 `.gitignore` 檔案（排除 venv、.env、__pycache__）
- [ ] 規劃各檔案職責與功能

**驗證標準**：
- ✅ 所有檔案已建立
- ✅ 專案結構清晰易懂
- ✅ Git 配置正確

***

### 工作任務 1.3：環境變數設定（15分鐘）

**任務目標**：配置 OpenAI API 與 Agent 參數

**配置項目**：
- [ ] 建立 `.env` 檔案
- [ ] 設定 `OPENAI_API_KEY`（從 OpenAI 取得）
- [ ] 設定 `OPENAI_MODEL`（建議：gpt-4o-mini）
- [ ] 設定 `AGENT_NAME`（旅遊規劃助理）
- [ ] 設定 `AGENT_LANGUAGE`（繁體中文）
- [ ] 設定 `DEBUG_MODE`（False，可選）

**驗證步驟**：
- [ ] 測試環境變數載入
- [ ] 驗證 API Key 有效性
- [ ] 確認不會將 .env 上傳到 Git

**驗證標準**：
- ✅ .env 檔案已建立並配置
- ✅ 環境變數可正確讀取
- ✅ API Key 有效且有額度

***

## 📐 階段二：State Schema 設計（2小時）

### 工作任務 2.1：定義 State 結構（1小時）

**任務目標**：設計符合旅遊規劃需求的狀態結構

**State 欄位設計**：
- [ ] `messages`：對話訊息歷史（使用 add_messages reducer）
  - 類型：`Annotated[list[AnyMessage], add_messages]`
  - 用途：儲存完整對話歷史，自動累積避免重複
- [ ] `user_preferences`：使用者偏好設定
  - 類型：`dict`
  - 用途：儲存預算、興趣、旅遊風格等偏好

**設計原則**：
- [ ] 最小化原則：MVP 階段僅包含必要欄位
- [ ] 型別安全：使用 TypedDict 確保型別檢查
- [ ] 擴展性：預留後續擴展空間（註解標記）

**執行步驟**：
- [ ] 在 `state.py` 定義 `AgentState` 類別
- [ ] 加入型別註解與 docstring
- [ ] 建立測試用狀態實例
- [ ] 驗證狀態結構正確性

**驗證標準**：
- ✅ State Schema 定義完整
- ✅ 型別檢查通過
- ✅ 測試實例可正常建立
- ✅ 執行 `python state.py` 無錯誤

***

### 工作任務 2.2：State Schema 文檔撰寫（30分鐘）

**任務目標**：撰寫詳細的設計文檔與註解

**文檔內容**：
- [ ] 設計原則說明
- [ ] 各欄位詳細說明（用途、類型、範例）
- [ ] Reducer 機制說明（add_messages 如何運作）
- [ ] 未來擴展欄位預告（Day 3-4 會加入的欄位）
- [ ] 使用範例與注意事項

**驗證標準**：
- ✅ 文檔完整且易懂
- ✅ 其他開發者可快速理解設計
- ✅ 預留擴展空間已註明

***

## 🧠 階段三：LLM 節點實作（3小時）

### 工作任務 3.1：建立 LLM 呼叫節點（2小時）

**任務目標**：實作與 OpenAI 互動的推論節點

**節點設計**：
- [ ] 初始化 ChatOpenAI 實例
  - 從環境變數讀取 model 和 api_key
  - 設定 temperature（建議 0.7）
- [ ] 定義系統提示詞（SYSTEM_PROMPT）
  - 定義 Agent 角色：專業旅遊規劃助理
  - 定義職責：理解需求、提供建議、記住偏好
  - 定義回應風格：簡潔、友善、實用、繁體中文
- [ ] 實作 `call_model_node` 函數
  - 接收 `AgentState` 作為輸入
  - 注入系統提示詞到訊息列表
  - 呼叫 LLM 生成回應
  - 返回包含 AI 訊息的狀態更新字典

**設計亮點**：
- [ ] 純函數設計：只返回狀態更新，不修改輸入
- [ ] 系統提示詞每次注入：確保 LLM 知道角色
- [ ] 環境變數控制：方便切換模型

**執行步驟**：
- [ ] 在 `nodes.py` 實作 LLM 節點
- [ ] 加入詳細的 docstring 說明
- [ ] 建立測試函數驗證節點功能
- [ ] 測試不同輸入情境

**驗證標準**：
- ✅ 節點可正常呼叫 OpenAI API
- ✅ 返回格式正確（dict 包含 messages）
- ✅ AI 回應符合預期（中文、友善）
- ✅ 執行 `python nodes.py` 測試通過

***

### 工作任務 3.2：錯誤處理機制（30分鐘）

**任務目標**：增強節點的錯誤處理能力

**錯誤處理項目**：
- [ ] API 連接失敗處理
- [ ] 無效回應格式處理
- [ ] 額度不足錯誤處理
- [ ] 返回友善錯誤訊息給使用者
- [ ] 記錄錯誤日誌（可選）

**執行步驟**：
- [ ] 在節點函數加入 try-except 區塊
- [ ] 定義錯誤訊息格式
- [ ] 測試各種錯誤情境
- [ ] 確保錯誤時不中斷程式

**驗證標準**：
- ✅ 錯誤不會導致程式崩潰
- ✅ 錯誤訊息清晰易懂
- ✅ 使用者可重試操作

***

### 工作任務 3.3：節點單元測試（30分鐘）

**任務目標**：建立節點測試函數

**測試項目**：
- [ ] 基本功能測試：正常輸入返回正確
- [ ] 邊界情況測試：空訊息、超長訊息
- [ ] 錯誤處理測試：無效 API Key、網路中斷
- [ ] 輸出格式驗證：確保返回正確的 dict 結構

**驗證標準**：
- ✅ 所有測試案例通過
- ✅ 測試覆蓋主要功能
- ✅ 可快速驗證節點正確性

***

## 🔗 階段四：Graph 架構建構（3小時）

### 工作任務 4.1：建立基礎 Graph（2小時）

**任務目標**：使用 LangGraph 建構最簡單的線性流程

**Graph 架構設計**：
```
START → LLM Node → END
```

**執行步驟**：
- [ ] 在 `graph.py` 建立 `create_graph` 函數
- [ ] 初始化 `StateGraph` 並傳入 `AgentState`
- [ ] 註冊節點：`workflow.add_node("llm", call_model_node)`
- [ ] 定義邊：
  - `workflow.add_edge(START, "llm")`
  - `workflow.add_edge("llm", END)`
- [ ] 初始化 `MemorySaver` 作為 checkpointer
- [ ] 編譯 Graph：`app = workflow.compile(checkpointer=memory)`
- [ ] 返回編譯後的應用

**記憶機制說明**：
- [ ] MemorySaver 提供 in-memory 狀態持久化
- [ ] thread_id 用於識別不同對話 session
- [ ] 同一 thread_id 的對話會共享狀態

**執行步驟**：
- [ ] 實作 Graph 建構邏輯
- [ ] 加入架構說明註解
- [ ] 建立測試函數驗證 Graph
- [ ] 測試單輪對話執行

**驗證標準**：
- ✅ Graph 可成功編譯
- ✅ 單輪對話執行正常
- ✅ 狀態更新正確
- ✅ 執行 `python graph.py` 測試通過

***

### 工作任務 4.2：Graph 視覺化文檔（30分鐘）

**任務目標**：撰寫 Graph 架構設計文檔

**文檔內容**：
- [ ] 當前架構圖（ASCII 流程圖）
- [ ] 各節點職責說明
- [ ] 記憶機制說明（Checkpointer、Thread ID）
- [ ] 未來擴展計畫（Day 3-4 會加入的節點）
- [ ] 執行流程說明

**驗證標準**：
- ✅ 架構圖清晰易懂
- ✅ 文檔完整詳細
- ✅ 方便後續維護

***

### 工作任務 4.3：Graph 單元測試（30分鐘）

**任務目標**：測試 Graph 執行流程

**測試項目**：
- [ ] Graph 編譯測試
- [ ] 單輪對話測試
- [ ] 狀態更新測試
- [ ] 記憶持久化測試（同一 thread_id）

**驗證標準**：
- ✅ 所有測試通過
- ✅ Graph 執行穩定
- ✅ 狀態管理正確

***

## 💻 階段五：主程式與互動介面（2小時）

### 工作任務 5.1：建立 CLI 介面（1.5小時）

**任務目標**：建立友善的命令列互動介面

**CLI 功能設計**：
- [ ] 顯示歡迎訊息與使用提示
- [ ] 初始化 Graph 應用
- [ ] 產生唯一 session ID（thread_id）
- [ ] 主對話循環
  - 接收使用者輸入
  - 檢查退出命令（exit、quit、離開）
  - 執行 Graph 並顯示 AI 回應
  - 更新當前狀態
- [ ] 錯誤處理與重試機制
- [ ] 優雅退出

**使用者體驗優化**：
- [ ] 清晰的視覺分隔（使用 = 或 -）
- [ ] 角色標記（👤 使用者、🤖 Agent）
- [ ] 思考中提示（🤔 思考中...）
- [ ] 錯誤提示（❌ 發生錯誤）
- [ ] 友善的退出訊息（👋 再見！）

**執行步驟**：
- [ ] 在 `main.py` 實作 CLI 主程式
- [ ] 加入完整的錯誤處理
- [ ] 優化使用者互動體驗
- [ ] 測試各種輸入情境

**驗證標準**：
- ✅ CLI 可正常啟動
- ✅ 可進行連續對話
- ✅ 退出命令正常運作
- ✅ 錯誤處理完善
- ✅ 使用者體驗良好

***

### 工作任務 5.2：增加 DEBUG 模式（30分鐘）

**任務目標**：提供調試模式方便開發

**DEBUG 功能**：
- [ ] 在 `.env` 加入 `DEBUG_MODE` 設定
- [ ] DEBUG 模式顯示狀態資訊
  - 當前訊息數量
  - 使用者偏好內容
  - 執行節點名稱（可選）
- [ ] 可切換開啟/關閉

**驗證標準**：
- ✅ DEBUG 模式可正常開啟/關閉
- ✅ 顯示資訊有助於調試
- ✅ 不影響正常使用

---

## ✅ 階段六：整合測試與驗證（2小時）

### 工作任務 6.1：單元測試套件（1小時）

**任務目標**：建立完整的測試套件

**測試函數規劃**：
- [ ] `test_state_schema()`：測試 State 定義
- [ ] `test_llm_node()`：測試 LLM 節點
- [ ] `test_single_turn()`：測試單輪對話
- [ ] `test_multi_turn()`：測試多輪對話記憶
- [ ] `run_all_tests()`：執行所有測試

**測試覆蓋範圍**：
- [ ] State Schema 正確性
- [ ] 節點功能完整性
- [ ] Graph 執行流程
- [ ] 記憶持久化機制
- [ ] 錯誤處理能力

**執行步驟**：
- [ ] 在 `test_agent.py` 實作所有測試
- [ ] 加入清晰的測試輸出
- [ ] 測試失敗時提供明確訊息
- [ ] 確保測試可重複執行

**驗證標準**：
- ✅ 所有測試通過
- ✅ 測試覆蓋主要功能
- ✅ 測試輸出清晰易讀

***

### 工作任務 6.2：完整驗收清單（1小時）

**任務目標**：執行完整的功能驗收

**驗收檢查清單**：

| 項目 | 驗證方法 | 預期結果 | 完成狀態 |
|------|----------|----------|---------|
| **環境設定** | 執行 import 測試 | 無錯誤 | [ ] |
| **State Schema** | 執行 `python state.py` | 測試通過 | [ ] |
| **LLM 節點** | 執行 `python nodes.py` | 產生回應 | [ ] |
| **Graph 編譯** | 執行 `python graph.py` | 編譯成功 | [ ] |
| **單元測試** | 執行 `python test_agent.py` | 所有測試通過 | [ ] |
| **CLI 啟動** | 執行 `python main.py` | 正常啟動 | [ ] |
| **基本對話** | 輸入「你好」 | 友善回應 | [ ] |
| **實際需求** | 輸入「推薦台北景點」 | 具體推薦 | [ ] |
| **中文支援** | 使用中文互動 | 正常顯示 | [ ] |
| **退出功能** | 輸入「exit」 | 正常退出 | [ ] |
| **錯誤處理** | 無效 API Key | 友善錯誤訊息 | [ ] |
| **記憶功能** | 連續對話 | 記得上下文 | [ ] |

**完整驗收流程**：

1. **環境驗證**
   - [ ] 執行環境測試命令
   - [ ] 確認所有套件可正常 import

2. **模組驗證**
   - [ ] 執行 `state.py` 驗證 State Schema
   - [ ] 執行 `nodes.py` 驗證 LLM 節點
   - [ ] 執行 `graph.py` 驗證 Graph 編譯

3. **單元測試**
   - [ ] 執行 `test_agent.py`
   - [ ] 確認所有測試通過

4. **整合測試**
   - [ ] 啟動 CLI：`python main.py`
   - [ ] 測試對話：
     - 基本互動：「你好」
     - 實際需求：「推薦台北景點」
     - 退出功能：「exit」
   
5. **已知限制確認**
   - [ ] 確認「它們的營業時間？」無法正確回應（這是正常的，Day 5-6 會修復）
   - [ ] 記錄其他發現的問題

**驗證標準**：
- ✅ 所有檢查項目通過
- ✅ 可進行基本對話
- ✅ 系統穩定運作
- ✅ 已知限制已記錄

***

## 📊 Day 1-2 完成標準

### 功能層面
- [ ] 可執行 `python main.py` 啟動 Agent
- [ ] 可與 Agent 進行基本對話（如「你好」、「推薦台北景點」）
- [ ] Agent 能在同一 session 內記住對話歷史
- [ ] Agent 用繁體中文友善回應
- [ ] 錯誤處理完善，不會輕易崩潰

### 技術層面
- [ ] 理解 LangGraph 的 State + Node + Edge 架構
- [ ] 理解如何在節點內使用 LangChain 元件（ChatOpenAI）
- [ ] 理解 MemorySaver 的記憶機制
- [ ] 理解 thread_id 如何識別對話 session
- [ ] 掌握 Graph 編譯與執行流程

### 產出層面
- [ ] 完整的專案檔案結構（8個檔案）
- [ ] 可執行的程式碼（無語法錯誤）
- [ ] 通過的測試套件（所有測試通過）
- [ ] 完整的文檔與註解
- [ ] README 說明檔案（可選）

***

## ⚠️ 常見問題預防

### 問題預防清單

**環境問題**：
- [ ] 確認 Python 版本 >= 3.10
- [ ] 確認虛擬環境已啟動
- [ ] 確認所有套件版本相容

**API 問題**：
- [ ] 確認 OpenAI API Key 有效
- [ ] 確認帳戶有足夠額度
- [ ] 確認 .env 檔案正確載入

**編碼問題**：
- [ ] 確認終端支援 UTF-8 編碼
- [ ] 確認中文顯示正常
- [ ] 必要時設定編碼參數

**記憶問題**：
- [ ] 確認使用相同 thread_id
- [ ] 確認狀態正確更新
- [ ] 確認 MemorySaver 正確初始化

***

## 🎯 下一步預告（Day 3-4）

完成 Day 1-2 後，將進入：

### Day 3-4 工作預告
- [ ] **工具整合**：加入景點搜尋工具、行程生成器
- [ ] **RAG 實作**：建立旅遊知識庫向量檢索
- [ ] **條件分支**：實現根據預算動態調整推薦
- [ ] **工具協作**：實現搜尋結果傳遞給行程規劃
- [ ] **錯誤重試**：實現 API 失敗時自動重試邏輯

***

## 📝 開發日誌建議

建議在開發過程中記錄：
- [ ] 每個階段的完成時間
- [ ] 遇到的問題與解決方案
- [ ] 需要改進的部分
- [ ] 學習心得與收穫

***

**準備好了嗎？讓我們開始 Day 1 的開發！** 🚀

請依照階段順序執行，每完成一個階段就在 checklist 打勾 ✅，這樣可以清楚追蹤進度。如果在某個階段遇到問題，可以隨時提問！

[1](https://ithelp.ithome.com.tw/articles/10389376)
[2](https://www.leadadds.com/zh/learning-centre/what-is-langgraph/)
[3](https://weii.dev/langchain-langgraph/)
[4](https://aict.nkust.edu.tw/digitrans/?p=7380)
[5](https://vocus.cc/article/690a669afd89780001c00eba)
[6](https://www.tenlong.com.tw/products/9789863128441)
[7](https://sider.ai/zh-TW/blog/ai-tools/langgraph-vs-langchain-which-framework-should-you-use-in-2025)
[8](https://ywctech.net/ml-ai/langchain-langgraph-agent-part2/)
[9](https://www.facebook.com/groups/gaitech/posts/1165211681329712/)